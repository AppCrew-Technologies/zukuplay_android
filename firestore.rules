rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Device tokens collection - clients can register, but only admins can read
    match /device_tokens/{token} {
      allow read: if request.auth != null && request.auth.token.admin == true;
      allow create, update: if true; // Allow device registration from apps
      allow delete: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Broadcasts collection - admins can create/update/delete, anyone can read
    match /broadcasts/{messageId} {
      allow read: if true;
      allow create, update, delete: if request.auth != null && 
        (request.auth.token.admin == true || request.auth.uid == "system");
    }
    
    // Also allow access to broadcast_messages for backwards compatibility
    match /broadcast_messages/{messageId} {
      allow read: if true;
      allow create, update: if true; // Allow app to store received messages
      allow delete: if request.auth != null && request
        .auth.token.admin == true;
    }
    
    // Stats collection - only admins can write, anyone can read
    match /stats/{statId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // App config collection - only admins can write, anyone can read
    match /app_config/{configId} {
      allow read: if true; 
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // AdMob Ad Configs collection - only admins can write, anyone can read
    match /ad_configs/{adId} {
      allow read: if true; // Apps need to read ad configs
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Ad Performance collection - apps can write performance data, admins can read
    match /ad_performance/{adId} {
      allow read: if request.auth != null && request.auth.token.admin == true;
      allow write: if true; // Apps need to write performance data
    }
    
    // Ad Manager Config collection - only admins can write, anyone can read
    match /ad_manager_config/{configId} {
      allow read: if true; // Apps need to read config
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
  }
} 